---
layout:     post
title:      CVE-2023-38501分析(XSS)
subtitle:   漏洞分析
date:       2025-03-14
author:     numb
header-img: img/home-bg-art.jpg
catalog: true
tags:
    - 漏洞分析


---

> 基于exploit的描述，这是一个对于copyparty版本小于1.8.6的漏洞
>
> 利用poc为：https://localhost:3923/?k304=y%0D%0A%0D%0A%3Cimg+src%3Dcopyparty+onerror%3Dalert(1)%3E

下载**[copyparty](https://github.com/9001/copyparty/tree/v1.8.4)**后，导入python包，运行该项目下scripts\pyinstaller\loader.py文件，然后访问**[本地url](http://127.0.0.1:3923/)**

如图:<img src="https://numb74.github.io/img/CVE/1.png">

首先使用 **[payload](https://localhost:3923/?k304=y%0D%0A%0D%0A%3Cimg+src%3Dcopyparty+onerror%3Dalert(%22numb%22)%3E)** 进行测试，复制地址输入给地址栏后可以得到弹窗如图：<img src="https://numb74.github.io/img/CVE/2.png">

url编码后可以知道原始构造为

```txt
https://localhost:3923/?k304=y\n\r\n\r<img src=copyparty onerror=alert("numb")>
```

对url地址做进一步处理，发现漏洞利用的关键点在于两个换行符，继续进一步分析换行符，将该次请求放进burp查询有效信息，测试没有换行符，单个换行符，双换行符三个情况，可以了解到单换行和未换行都会直接跳转到**[特定页面](https://localhost:3923/?h#cc)** 

双换行符以及以上换行符就会触发反射性XSS：

<img src="https://numb74.github.io/img/CVE/3.png">

无换行下payloay在响应包下识别图：

<img src="https://numb74.github.io/img/CVE/两个换行.png">

单个换行下payloay在响应包下识别图：

<img src="https://numb74.github.io/img/CVE/单个换行.png">

无换行下payloay在响应包下识别图：

<img src="https://numb74.github.io/img/CVE/无换行.png">



其漏洞函数在httpcli.py文件中set_k304函数中返回cookie没有处理，debug可知详细位置如图：

<img src="https://numb74.github.io/img/CVE/漏洞代码位置.png">

综合上述分析，漏洞已经完全得到理解了，首先前端发送一个get请求，后端处理cookie的时候没有过滤，导致响应包可以通过换行符截断cookie，使得前端理解截断后的字符的是html或者javascript

<img src="https://numb74.github.io/img/CVE/cookie截断.png">















参考资料：

[exploit](https://www.exploit-db.com/exploits/51635)

[copyparty](https://github.com/9001/copyparty/tree/v1.8.4)

